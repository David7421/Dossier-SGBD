
DROP DATABASE LINK CB.DBL;

DROP TABLE filmSchema;
DROP TABLE copieFilm;
DROP TABLE programmation;

CREATE TABLE filmSchema OF XMLType
XMLTYPE STORE AS OBJECT RELATIONAL
XMLSCHEMA "http://cc/film.xsd"
ELEMENT "film"
VARRAY "XMLDATA"."LIST_GENRE"."GENRE"
	STORE AS TABLE genres_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_PRODUCTEURS"."PRODUCTEUR"
	STORE AS TABLE producteurs_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_PAYS"."PAYS"
	STORE AS TABLE pays_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_ACTEURS"."ACTEUR"
	STORE AS TABLE acteurs_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_REALISATEURS"."REALISATEUR"
	STORE AS TABLE realisateurs_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_LANGUES"."LANGUE"
	STORE AS TABLE langues_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
VARRAY "XMLDATA"."LIST_AVIS"."AVIS"
	STORE AS TABLE avis_table ((PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)));


CREATE TABLE copieFilm OF XMLType
XMLTYPE STORE AS OBJECT RELATIONAL
XMLSCHEMA "http://cc/copie.xsd"
ELEMENT "copie";

CREATE TABLE programmation OF XMLType
XMLTYPE STORE AS OBJECT RELATIONAL
XMLSCHEMA "http://cc/programmation.xsd"
ELEMENT "programmation";

CREATE TABLE tmpXMLCopy (xml_col XMLType)
XMLTYPE xml_col STORE AS BINARY XML;

ALTER TABLE filmSchema
ADD CONSTRAINT pk_filmschema PRIMARY KEY (XMLDATA."IDFILM");

ALTER TABLE programmation
ADD CONSTRAINT pk_programmationPRIMARY PRIMARY KEY (XMLDATA."IDFILM", XMLDATA."IDCOPIE", XMLDATA."DEBUT");

ALTER TABLE copieFilm
ADD CONSTRAINT pk_copieFilmPRIMARY PRIMARY KEY (XMLDATA."IDFILM", XMLDATA."IDCOPIE");

ALTER TABLE copieFilm 
ADD CONSTRAINT fk_film
FOREIGN KEY (XMLDATA."IDFILM") REFERENCES filmSchema(XMLDATA."IDFILM");

ALTER TABLE programmation 
ADD CONSTRAINT fk_progra
FOREIGN KEY (XMLDATA."IDFILM") REFERENCES filmSchema(XMLDATA."IDFILM");

CREATE DATABASE LINK CB.DBL CONNECT TO CB IDENTIFIED BY CB USING 'CB';

COMMIT;
