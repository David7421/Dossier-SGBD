-------------------
-- SPECIFICATION --
-------------------

CREATE OR REPLACE PACKAGE GESTIONCB
IS
	--PROCEDURE BACKUP;
END;










----------
-- BODY --
----------

CREATE OR REPLACE PACKAGE BODY GESTIONCB
AS

	PROCEDURE BACKUP
	IS
	BEGIN

		-- UTILISATEURS
		INSERT INTO UTILISATEUR@CBB.DBL (LOGIN, PASSWORD, TOKEN) SELECT FOR UPDATE LOGIN, PASSWORD, 'OK' FROM UTILISATEUR WHERE TOKEN IS NULL;
		UPDATE UTILISATEUR SET TOKEN = 'OK' WHERE TOKEN IS NULL;

		-- EVALUATIONS
		INSERT INTO EVALUATION@CBB.DBL (IDFILM, LOGIN, COTE, AVIS, DATEEVAL, TOKEN) SELECT FOR UPDATE IDFILM, LOGIN, COTE, AVIS, DATEEVAL, 'OK' FROM EVALUATION WHERE TOKEN = 'KO';
		UPDATE EVALUATION SET TOKEN = 'OK' WHERE TOKEN = 'KO';

		COMMIT;

	END;

END;
